<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BanG Dream! 华容道</title>
    <style>
      html.assets-pending body {
        margin: 0;
        min-height: 100vh;
        font-family: "Songti SC", "STSong", "Noto Serif SC", "Source Han Serif SC", "SimSun", serif;
        background:
          radial-gradient(circle at 12% 14%, #fff7a8 0%, transparent 30%),
          radial-gradient(circle at 88% 16%, #8be7ff 0%, transparent 32%),
          radial-gradient(circle at 26% 88%, #ff9ec8 0%, transparent 33%),
          radial-gradient(circle at 78% 82%, #ffcf6d 0%, transparent 30%),
          linear-gradient(165deg, #ffeef8 0%, #f1efff 48%, #e8fbff 100%);
      }

      html.assets-pending .app {
        visibility: hidden;
      }

      #bootSplash {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        color: #4a1648;
        letter-spacing: 0.08em;
        font-weight: 600;
        background: transparent;
        z-index: 9999;
        transition: opacity 0.14s ease;
      }

      html:not(.assets-pending) #bootSplash {
        opacity: 0;
        pointer-events: none;
      }
    </style>
    <script>
      (() => {
        const root = document.documentElement;
        root.classList.add("assets-pending");

        const APP_CONFIG_URL = "data/app-config.json";
        const STYLE_URL = "src/ui/styles.css";
        const ENTRY_URL = "src/main.js";
        let revealed = false;
        const revealApp = () => {
          if (revealed) {
            return;
          }
          revealed = true;
          root.classList.remove("assets-pending");
        };
        const revealTimer = window.setTimeout(revealApp, 3000);

        const sanitizeToken = (value) =>
          String(value ?? "")
            .trim()
            .replace(/[^0-9A-Za-z._-]/g, "-");

        const appendAssets = (stamp) => {
          const token = stamp || Date.now().toString(36);

          const style = document.createElement("link");
          style.rel = "stylesheet";
          style.href = `${STYLE_URL}?v=${encodeURIComponent(token)}`;
          style.addEventListener("load", () => {
            window.clearTimeout(revealTimer);
            revealApp();
          });
          style.addEventListener("error", () => {
            window.clearTimeout(revealTimer);
            revealApp();
          });
          document.head.append(style);

          const entry = document.createElement("script");
          entry.type = "module";
          entry.src = `${ENTRY_URL}?v=${encodeURIComponent(token)}`;
          document.head.append(entry);
        };

        fetch(APP_CONFIG_URL, { cache: "no-store" })
          .then((res) => (res.ok ? res.json() : null))
          .then((config) => {
            const version = sanitizeToken(config?.version);
            const updated = sanitizeToken(config?.footer?.lastUpdated);
            const stamp = [version, updated].filter(Boolean).join("-");
            appendAssets(stamp);
          })
          .catch(() => {
            appendAssets("");
          });
      })();
    </script>
  </head>
  <body>
    <div id="bootSplash" aria-live="polite">正在加载...</div>
    <main class="app">
      <header class="topbar">
        <div>
          <p id="appVersion" class="app-version">v0.0.0</p>
          <h1>BanG Dream! 华容道</h1>
          <p id="goalText">目标：将目标角色移动到底部中间出口</p>
        </div>
        <div class="stats">
          <span>步数 <strong id="steps">0</strong></span>
          <span>用时 <strong id="timer">00:00</strong></span>
        </div>
      </header>

      <section class="controls">
        <div class="controls-row controls-main">
          <label for="targetChar">需要移出的角色</label>
          <select id="targetChar"></select>
          <label for="targetMode">目标位模式</label>
          <select id="targetMode">
            <option value="origin">原位目标</option>
            <option value="swap_michelle">与米歇尔换位（保留块大小）</option>
          </select>
          <label for="fitMode" hidden>棋盘拟合</label>
          <select id="fitMode" hidden>
            <option value="balanced">自然拟合</option>
            <option value="strict">严格比例</option>
          </select>
          <label class="inline-check" for="showNamesToggle">
            <input id="showNamesToggle" type="checkbox" />
            显示角色名
          </label>
        </div>
        <div class="controls-row controls-actions">
          <button id="restartBtn" type="button">重新开始</button>
          <button id="resetTimerBtn" type="button">重置计时</button>
          <button id="autoSolveBtn" type="button">自动求解</button>
          <span id="solveStatus" class="solve-status" aria-live="polite"></span>
        </div>
      </section>

      <section class="board-wrap">
        <div id="board" class="board" aria-label="华容道棋盘"></div>
      </section>

      <section id="winPanel" class="win-panel hidden" aria-live="polite">
        <h2>通关</h2>
        <p id="winText">目标角色已到出口。</p>
      </section>

      <section id="noticeBar" class="notice-bar" aria-live="polite">
        <span class="notice-tag">系统</span>
        <span id="noticeText" class="notice-text">正在加载通知...</span>
      </section>

      <footer class="app-footer" aria-label="应用信息">
        <span id="footerDev">Developed by PichuTheLolitaNeko</span>
        <span id="footerPowered">Powered by gpt-5.3-codex (reasoning high, summaries auto)</span>
        <span id="footerUpdated">Last update: 2026-02-13</span>
      </footer>
    </main>
  </body>
</html>
