# 华容道项目进度

最后更新：2026-02-13

## 项目范围
- 基于 `img/` 目录内图片实现“传统曹操华容道（4x5 异形棋子）”。
- 目标平台：Web（PWA）优先，后续可扩展桌面与移动端壳。

## 里程碑
| 编号 | 里程碑 | 状态 | 说明 |
|---|---|---|---|
| M1 | 需求定稿 | 已完成 | 玩法调整为传统曹操华容道（4x5） |
| M2 | 工程初始化 | 已完成 | 建立无依赖 Web 工程骨架（HTML/CSS/ESM） |
| M3 | 棋盘与角色模块 | 已完成 | 棋子尺寸定义、布局渲染、角色素材映射 |
| M4 | 核心游戏引擎 | 已完成 | 合法移动、碰撞校验、胜利判定 |
| M5 | 交互与 UI | 已完成 | 点击/拖拽移动、计步计时、移动端适配 |
| M6 | 存档与关卡体验 | 规划中 | 本地存档、关卡切换与最佳成绩 |
| M7 | 测试与优化 | 规划中 | 单测、跨浏览器与性能验证 |
| M8 | 打包与交付 | 规划中 | PWA 打包与发布说明 |

## 每一步更新规则
每完成一个开发步骤（含小步提交）都要在本文档追加一条记录，且必须同时包含：
- `已完成功能`：本步真实完成并可验证的功能。
- `规划功能`：下一步准备实现的功能（可执行、可验收）。

## 更新记录
### Step 1（2026-02-13）
- 已完成功能：
  - 项目里程碑定义完成并落盘。
  - 明确素材目录为 `img/`（当前不存在 `imgs/`）。
- 规划功能：
  - 初始化前端工程（Vite + TypeScript）。
  - 建立基础目录结构与运行脚本。

### Step 2（2026-02-13）
- 已完成功能：
  - 玩法需求更新为传统曹操华容道（4x5，异形棋子）。
  - 明确需要提供“角色图片映射”可配置接口，支持后续自定义角色素材。
- 规划功能：
  - 工程初始化（Vite + TypeScript）并建立基础目录结构。
  - 定义默认角色映射配置（默认优先使用 `img/1.JPG`，其余角色可覆盖）。

### Step 3（2026-02-13）
- 已完成功能：
  - 确认“配置文件自由选择角色图”方案：通过 `角色ID -> 图片路径` 映射实现。
  - 明确图片来源为 `img/` 目录，允许同一图片复用到多个角色。
- 规划功能：
  - 落地配置结构（`pieces` 棋子定义 + `skins` 角色贴图映射）。
  - 在初始化工程中接入默认皮肤与可覆盖机制。

### Step 4（2026-02-13）
- 已完成功能：
  - 初始化 Web 工程骨架：`index.html`、`src/main.js`、`src/ui/styles.css`。
  - 完成配置层：`src/config/pieces.js`（棋子定义）与 `src/config/skins.js`（角色ID到图片映射）。
- 规划功能：
  - 实现核心引擎（合法移动、占用检测、胜利判定）。
  - 接入皮肤预设切换和棋盘渲染。

### Step 5（2026-02-13）
- 已完成功能：
  - 实现核心引擎 `src/game/engine.js`：单步移动、边界/碰撞校验、可移动方向查询、胜利判定。
  - 完成主界面交互：棋盘渲染、拖拽/点击移动、步数与计时、胜利提示、重开与重置计时。
  - 完成皮肤预设切换：在 UI 中选择 `SKIN_PRESETS` 并动态应用角色图片。
- 规划功能：
  - 增加运行说明与配置说明文档。
  - 完成基础自检并整理下一里程碑（存档、关卡、测试）。

### Step 6（2026-02-13）
- 已完成功能：
  - 新增 `README.md`，提供本地运行方式与角色皮肤配置说明。
  - 完成语法自检：`src/main.js`、`src/game/engine.js` 通过 Node 语法检查。
- 规划功能：
  - M6：增加本地存档（当前局面、步数、计时）与最佳成绩记录。
  - M7：补充引擎单测与跨浏览器验证清单。

### Step 7（2026-02-13）
- 已完成功能：
  - 完成引擎运行级自检：验证初始未通关、可移动方向计算、移动成功后步数递增。
- 规划功能：
  - M6：实现局面持久化与自动恢复。
  - M7：整理最短路径校验与回归测试用例。

### Step 8（2026-02-13）
- 已完成功能：
  - 增加 `src/config/image_roles.js`：提供 `img -> 角色名` 映射、识别置信度与不确定标记。
  - 默认关闭角色名显示（`SHOW_ROLE_NAMES_DEFAULT=false`），并在 UI 提供“显示角色名”开关。
- 规划功能：
  - 按当前皮肤图片尺寸自动拟合棋盘格宽高比。
  - 增加自动求解功能并接入界面。

### Step 9（2026-02-13）
- 已完成功能：
  - 完成棋盘自动拟合：根据当前皮肤所用图片尺寸计算 `--cell-w/--cell-h`，窗口变化时自动重算。
  - 完成自动求解器 `src/game/solver.js`（BFS + 同尺寸棋子状态归一化），支持从当前局面求解。
  - 在 UI 接入“自动求解”按钮与执行动画。
- 规划功能：
  - 补充识别映射文档，便于手动修正不确定角色。
  - 完成求解器有效性自检并记录结果。

### Step 10（2026-02-13）
- 已完成功能：
  - 新增 `docs/img-role-map.md`，集中记录 `img` 与 BangDream 角色对应关系及不确定项。
  - 完成求解器运行级验证：初始局面可解，得到 116 步路径并可完整执行至通关。
- 规划功能：
  - M6：实现本地存档（当前局面、步数、计时）与自动恢复。
  - M7：补充引擎/求解器回归测试用例。

### Step 11（2026-02-13）
- 已完成功能：
  - 完成随机局面验证：随机移动 20 步后，自动求解仍可返回有效路径并成功通关。
- 规划功能：
  - M6：增加本地持久化与恢复。
  - M7：补充固定测试样例，覆盖更多中间局面。

### Step 12（2026-02-13）
- 已完成功能：
  - 角色映射改为 JSON 配置：新增 `data/image-role-map.json`，支持直接编辑 `img -> 角色名`。
  - 主程序改为运行时读取 JSON（读取失败时回退到角色ID显示）。
  - 清理旧映射文件，避免多入口维护。
- 规划功能：
  - 提升棋盘拟合策略，增加“最佳拟合”和“严格比例（Plan2）”两种模式。
  - 补充文档说明和 UI 入口。

### Step 13（2026-02-13）
- 已完成功能：
  - 新增棋盘拟合模式选择器：`最佳拟合` / `Plan2 严格比例`。
  - `最佳拟合`：按棋子面积加权，最小化显示比例误差。
  - `Plan2 严格比例`：完全按图片原始比例计算格子比例。
  - 更新文档：`README.md`、`docs/img-role-map.md`。
  - 完成自检：JSON 解析、语法检查、求解器验证（116 步通关）。
- 规划功能：
  - M6：增加本地存档（局面/步数/计时）与自动恢复。
  - M7：把拟合模式与求解器加入回归测试用例。

### Step 14（2026-02-13）
- 已完成功能：
  - 新增图片显示模式选择器：`裁切填充` / `完整显示（不裁切）`。
  - 不裁切模式采用 `background-size: contain`，并为留白区域增加底色承接。
  - 运行时可直接切换图片显示模式，无需刷新页面。
- 规划功能：
  - M6：实现本地存档并记住拟合模式/图片显示模式偏好。
  - M7：增加显示模式切换的回归检查。

### Step 15（2026-02-13）
- 已完成功能：
  - 新增 `Plan3 自由比例` 模式（`index.html` 增加游戏模式切换）。
  - 新增 `src/game/free_engine.js`：按图片比例生成棋子尺寸，构建非 4x5 固定棋盘的类华容道规则。
  - 自由比例模式下强制不裁切显示，并通过棋子框比例匹配图片比例实现“无裁切、无留白”。
  - 经典模式逻辑与自动求解保持可用；自由比例模式暂不支持自动求解。
  - 完成验证：经典求解器 116 步可通关；自由比例初始布局无重叠且存在可移动棋子。
- 规划功能：
  - M6：增加模式偏好、本地进度与局面恢复。
  - M7：补充自由比例模式的回归验证（碰撞、边界、胜利判定）。

### Step 16（2026-02-13）
- 已完成功能：
  - 完成自由比例模式运行级回归：随机移动 50 步，移动与步数统计一致，碰撞与边界规则稳定。
  - 更新文档：补充 Plan3 与自动求解适用范围说明（`README.md`）。
- 规划功能：
  - M6：实现本地存档，并记录游戏模式/拟合模式/显示模式偏好。
  - M7：加入自由比例模式胜利判定与出口对齐的固定测试样例。

### Step 17（2026-02-13）
- 已完成功能：
  - UI 与文案更新为 `BanG Dream! 华容道`，并将目标/通关提示改为动态角色名。
  - 控制项改造：将“角色皮肤配置”替换为“需要移出的角色”选择器。
  - 棋盘拟合名称去除 Plan 编号，改为 `自然拟合` / `严格比例` / `方向弹性`。
  - 新增 `data/piece-layout.json`，支持按箭头思路调整角色在棋盘中的映射站位。
  - 主题配色改为 kirakira/dokidoki 风格（高亮粉、糖果黄、明亮青）。
- 规划功能：
  - M6：记录目标角色与模式偏好（本地持久化）。
  - M7：补充角色映射与布局映射的配置校验测试。

### Step 18（2026-02-13）
- 已完成功能：
  - Plan3 自动求解接入：新增 `src/game/free_solver.js` 轨迹回退求解器。
  - 自由比例模式重构：`src/game/free_engine.js` 生成可回退求解的起始局面并维护移动轨迹。
  - 自动求解现在同时支持经典模式与自由比例模式。
  - 回归验证通过：
    - 经典模式求解 116 步可通关；
    - 自由比例模式初始局面可自动求解；
    - 自由比例模式随机操作后仍可自动求解到通关。
- 规划功能：
  - M6：实现本地存档（含目标角色、游戏模式、拟合方式、图片显示方式）。
  - M7：增加“自由比例 + 自动求解”场景下的长期回归测试。

### Step 19（2026-02-13）
- 已完成功能：
  - 根据新需求精简控制项：`棋盘拟合`仅保留 `自然拟合` / `严格比例`。
  - 移除“方向弹性”与“图片显示”切换项，降低配置复杂度。
  - 图片显示策略改为固定规则：经典模式 `cover`，自由比例模式 `contain`。
  - 保留自由比例模式与其自动求解器能力（轨迹回退解法不变）。
  - 更新文档：`README.md` 同步新的控制项与显示规则。
- 规划功能：
  - 制定并固化“图片预处理比例规范”（按棋子位目标宽高比导出素材）。
  - 增加比例规范校验脚本（检查 `img/` 是否偏离目标比例）。

### Step 20（2026-02-13）
- 已完成功能：
  - 按用户指定的角色尺寸关系完成棋子位重映射（`data/piece-layout.json`）：
    - `2x2`：米歇尔；
    - `2x1`：友希那；
    - `1x2`：若麦/摩卡/有咲/伊芙；
    - `1x1`：其余角色。
  - 批量处理 `img/*.JPG`：将对应图片中心裁切为目标比例（精确到 `2:1 / 1:1 / 1:2`）。
  - 自动备份原图到 `img/_backup_before_ratio_fix_20260213/`。
  - 比例校验通过：当前 `piece-layout` 中每个棋子位引用图片与目标比例 100% 匹配。
  - 更新文档：`README.md`、`docs/img-role-map.md`。
- 规划功能：
  - 增加可复用的“比例重导出脚本”（参数化输入角色分组与输出目录）。
  - 增加启动时比例告警（图片比例不匹配时提示具体角色和建议值）。

### Step 21（2026-02-13）
- 已完成功能：
  - 整体界面缩放调整为 90%：在 `src/ui/styles.css` 的 `.app` 容器增加统一缩放（`transform: scale(0.9)`）。
  - 缩放原点设为顶部居中（`transform-origin: top center`），保持布局居中与棋盘位置稳定。
- 规划功能：
  - 评估是否需要加入“UI 缩放倍率”配置项（如 85%/90%/100%）。
  - 在移动端做一次缩放后的可用性回归（按钮点击区域与棋盘拖拽手感）。

### Step 22（2026-02-13）
- 已完成功能：
  - 按需求隐藏“游戏模式”选项（仅隐藏 UI 控件，底层模式逻辑保留）。
  - 通过在 `index.html` 对 `#gameMode` 及其 `label` 添加 `hidden` 样式类实现无侵入改动。
- 规划功能：
  - 根据后续确认决定是否彻底移除自由比例模式入口或改为高级设置入口。
  - 继续处理“目标角色尺寸对应出口判定 + 求解器优化”方案。

### Step 23（2026-02-13）
- 已完成功能：
  - 彻底禁用自由比例模式：移除界面中的“游戏模式”入口，并移除主流程中的自由比例分支调用。
  - 目标角色不再强制替换到 `2x2` 棋子位；改为按 `piece-layout` 中该角色当前棋子位作为目标棋子。
  - 经典引擎胜利判定升级为按目标棋子尺寸判定出口：
    - `2x2 / 2x1`：需完整占据底部中间两格；
    - `1x2 / 1x1`：到底部中间任一格即可。
  - 经典求解器升级：
    - 支持 `goalPieceId`（任意目标棋子）；
    - 状态压缩改为“目标棋子保留身份 + 其余同尺寸棋子合并”；
    - 保持 BFS 最短步特性。
  - 回归验证通过：所有尺寸目标均可求解并可回放到通关（含 `caocao=116` 步）。
- 规划功能：
  - 在 UI 中增加“当前目标尺寸与出口规则”提示，减少歧义。
  - 评估是否加入求解性能统计（搜索节点数/耗时）显示。

### Step 24（2026-02-13）
- 已完成功能：
  - 修复“排版过紧”观感：经典棋盘增加统一棋子缝隙（`--piece-gap`），棋子不再满格贴边。
  - 增加底部中间出口浅色开口视觉（`board::before`），使棋盘更接近参考图 p2 的空间感。
  - 保持玩法与碰撞规则不变，仅做视觉层调整。
  - 语法检查：`src/main.js` 通过。
- 规划功能：
  - 视反馈微调缝隙大小（`4px/5px/6px`）与出口浅色块亮度。
  - 评估是否默认开启角色名显示，进一步贴近 p2 的信息密度。

### Step 25（2026-02-13）
- 已完成功能：
  - 按“真实比例自然拟合”诉求，恢复 `img/` 为原始素材比例（从备份目录回拷）。
  - 自然拟合下改为更宽松的自适应缝隙：`piece-gap` 随格高动态计算（自然拟合更松、严格比例更紧）。
  - 保持规则与求解器不变，回归验证通过（`caocao` 仍为 116 步最短）。
- 规划功能：
  - 继续微调自然拟合的缝隙系数，匹配你目标中的 p2 视觉密度。
  - 视需要增加“自然拟合仅影响排版，不改变规则”的说明文案。

### Step 26（2026-02-13）
- 已完成功能：
  - 字体风格整体切换为宋体系（全局 `Songti/STSong/Noto Serif SC` 回退栈），标题字重与字距同步调整为更设计化的衬线风格。
  - 控制区改为两行布局：第一行放角色与拟合设置，第二行单独放 `重新开始 / 重置计时 / 自动求解`。
  - 新增“目标位模式”：
    - `原位目标`；
    - `与米歇尔换位`（目标角色与米歇尔交换棋子位，自动适配不同尺寸位）。
  - 角色下拉排序改为按 `img1 -> img10` 数值顺序，且仅显示角色名，不再显示 JPG 路径。
  - 文档同步：`README.md`、`docs/img-role-map.md`。
- 规划功能：
  - 根据视觉反馈继续微调宋体标题风格（字距、装饰线、大小层级）。
  - 评估是否增加“目标位模式”的简短提示文案，降低首次使用理解成本。

### Step 27（2026-02-13）
- 已完成功能：
  - 出口规则固定：底部中间出口始终为 `2x1`，不再随目标角色尺寸变化（UI 出口宽度固定）。
  - 重构“与米歇尔换位”模式逻辑：
    - 不再把目标角色替换成米歇尔尺寸；
    - 目标角色保持原棋子块大小；
    - 按目标棋子自动应用对应的可解换位布局模板（自动填充其余棋子位）。
  - 新增 `src/config/swap_layouts.js`，集中维护各目标棋子的可解换位布局。
  - `src/game/engine.js` 支持以自定义初始棋盘创建状态（`initialPieces`）。
  - 回归验证通过：换位模式下各目标棋子均可自动求解并完成通关。
- 规划功能：
  - 根据你的体验继续微调各换位模板，让“米歇尔换位”的视觉位置更符合直觉。
  - 如需进一步泛化，后续可补“运行时自动搜索可解换位布局”替代静态模板。

### Step 28（2026-02-13）
- 已完成功能：
  - 重算并更新全部“与米歇尔换位”静态模板，目标为“上半区尽可能不留空位”。
  - 新模板在上三行空位数达到 `0`（所有非米歇尔目标均满足），保持视觉更紧凑整齐。
  - 可解性回归通过：所有换位模板均可由自动求解器求解并通关。
- 规划功能：
  - 按你的主观视觉偏好微调个别模板（在“上部无空位”前提下调角色相对位置）。
  - 如需彻底通用化，增加运行时模板搜索并缓存最优布局。

### Step 29（2026-02-13）
- 已完成功能：
  - 确认并保留方案 2：`guanyu` 继续使用可解特例换位模板（不强制顶行中间）。
  - 角色下拉新增“自动求解预计步数”显示（按当前目标位模式实时/缓存计算）。
  - 预计步数计算覆盖全部角色：调用经典求解器按目标角色与模板起局逐项求解。
  - 文档更新：`README.md` 补充预计步数显示说明。
- 规划功能：
  - 若你确认启用，可新增“出口预留空位”模板集（初始不占据底部中间出口）。
  - 增加预计步数计算中的性能提示（计算中状态与失败回退文案）。

### Step 30（2026-02-13）
- 已完成功能：
  - 按最新需求移除“角色下拉中的预计步数”展示，切换角色处仅显示角色名。
  - 更新若麦（`zhangfei`）换位模板：按箭头方向将底部角色（`soldier4`）左移一格。
  - 回归验证通过：若麦换位模板仍可自动求解（16 步可解）。
  - 给出移动方案验证：从旧布局到新布局可执行 `soldier4 -> left` 单步完成。
- 规划功能：
  - 若需要，继续把“出口预留空位”模板切为默认换位模板。
  - 增加“模板预览/说明”文本，便于理解每个换位布局差异。

### Step 31（2026-02-13）
- 已完成功能：
  - 全量检查并修正所有非米歇尔换位模板（`src/config/swap_layouts.js`）。
  - 当前 9 个非米歇尔模板全部满足：初始时底部中间 `2x1` 出口留空。
  - 同时保持可解：每个模板都可被自动求解器求解通关。
  - 文档更新：`README.md` 补充“非米歇尔换位模板出口留空”说明。
- 规划功能：
  - 若你希望，我可以继续按视觉偏好微调每个模板中角色的相对排布（在不破坏“出口留空+可解”的前提下）。
  - 可增加调试开关：在界面上显示当前模板ID与模板约束是否命中。

### Step 32（2026-02-13）
- 已完成功能：
  - 面向 GitHub 发布重写 `README.md`，结构化补充：
    - 项目介绍与功能概览；
    - 玩法与胜利判定；
    - 本地运行方式；
    - 部署说明（GitHub Pages / Vercel / Netlify）；
    - 配置说明（`data/image-role-map.json`、`data/piece-layout.json`、`src/config/swap_layouts.js`）；
    - 项目结构、开发说明与常见问题。
  - 清理旧版 README 中的阶段性/过时描述，使文档与当前代码状态一致。
- 规划功能：
  - 若准备公开仓库，可补充 `LICENSE` 与素材使用声明细则（商用/非商用边界）。
  - 可新增 `CONTRIBUTING.md`（提交流程、模板可解性校验脚本、代码规范）。

### Step 33（2026-02-13）
- 已完成功能：
  - 新增仓库根目录 `.gitignore`，覆盖常见无关文件：
    - 系统文件（`.DS_Store`、`Thumbs.db`）；
    - 编辑器目录（`.idea/`、`.vscode/`）；
    - 日志与构建产物（`*.log`、`node_modules/`、`dist/` 等）；
    - 本地环境配置与缓存（`.env*`、`__pycache__/`）。
  - 保持当前项目核心资源不受影响（`img/`、`data/`、`docs/`、`src/`）。
- 规划功能：
  - 执行首次提交并推送到 `https://github.com/Pichuworks/bangdream-huarongdao.git`。
  - 推送完成后启用 GitHub Pages 并验证访问地址。

### Step 34（2026-02-13）
- 已完成功能：
  - 新增界面底部专用通知栏（`index.html` + `src/ui/styles.css`），与游戏状态区分离。
  - 新增通知配置文件 `data/notice-config.json`，支持通过配置维护通知内容。
  - `src/main.js` 接入通知逻辑：
    - 启动时读取通知配置；
    - 按 `refreshIntervalSec` 定时重新拉取配置；
    - 多条通知按 `rotateIntervalSec` 轮播展示；
    - 配置读取失败时保底显示告警通知，避免空栏。
  - 文档同步：`README.md` 增加通知栏配置说明。
- 规划功能：
  - 可选增加“通知点击跳转链接”字段（如活动页/更新日志）。
  - 可选增加“生效时间窗口”（开始/结束时间）以支持限时通知。

### Step 35（2026-02-13）
- 已完成功能：
  - 通知配置升级：每条通知支持开始/结束时间窗口（`startAt` / `endAt`）。
  - 支持每年特定日期与日期区间规则：
    - `annualDate` / `annualDates`（`MM-DD`）；
    - `annualStart` / `annualEnd`（`MM-DD`，支持跨年区间）。
  - 通知筛选逻辑更新：
    - 先按绝对时间窗口过滤；
    - 再按年度日期规则过滤；
    - 无命中时显示“当前暂无有效通知”保底文案。
  - 文档与示例同步：
    - `README.md` 新增时间字段说明；
    - `data/notice-config.json` 新增含年度日期规则的示例。
- 规划功能：
  - 可选支持通知链接字段（点击跳转到公告/活动页）。
  - 可选支持按优先级置顶（重要通知不轮播或延长展示时长）。

### Step 36（2026-02-13）
- 已完成功能：
  - 通知配置分层：
    - 将原通知配置迁移为 `data/notice-config.demo.json`（保留示例与历史规则）；
    - 生成生产配置 `data/notice-config.json`。
  - 生产配置新增首条通知：
    - 文案：`【祥子小姐生日快乐！情人节出生的大小姐值得被爱！】`
    - 生效规则：每年 `02-13` 到 `02-15`（`annualStart` / `annualEnd`）。
    - 主题色：`#7799CC`。
  - 通知系统新增每条通知主题色能力：
    - 配置字段 `themeColor`（支持 `#RRGGBB` / `#RGB`）；
    - 前端动态应用边框、背景、标签与文字配色；
    - 与现有 `level` 样式兼容，不设置 `themeColor` 时沿用默认主题。
  - 文档更新：`README.md` 增加 `themeColor` 字段与 demo/prod 配置说明。
- 规划功能：
  - 可选增加通知优先级字段，支持节日通知置顶。
  - 可选增加“只展示一次”机制（按浏览器本地存储记忆已读状态）。

### Step 37（2026-02-13）
- 已完成功能：
  - 通知系统新增中国农历重复事件支持：
    - `lunarAnnualDate` / `lunarAnnualDates`（农历固定日）；
    - `lunarAnnualStart` / `lunarAnnualEnd`（农历区间，支持跨年）。
  - 农历判断实现为浏览器 `Intl` 中国农历日历（无需新增依赖），与原有公历规则并存。
  - 重复事件轮换默认值调整为 `5s`（`NOTICE_ROTATE_SEC_DEFAULT=5`）。
  - 生产通知配置更新（`data/notice-config.json`）：
    - 每年 02-13 到 02-15：`【祥子小姐生日快乐！情人节出生的大小姐值得被爱！】`，主题色 `#7799CC`；
    - 每年农历腊月 20 到正月初七：`祝大家春节玉快，阖家欢洛！`，火红主题色 `#E60012`；
    - 每年 02-22：`乐奈生日快乐！猫之日快乐！今天要吃抹茶芭菲！`，主题色 `#77DD77`。
  - 文档更新：`README.md` 增加农历通知字段说明与示例。
- 规划功能：
  - 可选增加通知优先级字段（春节/生日等节日通知优先展示）。
  - 可选增加“只展示一次”与“已读态”能力，避免重复打扰。

### Step 38（2026-02-13）
- 已完成功能：
  - 通知轮换默认间隔调整为 `10s`（代码默认值与配置示例同步）。
  - 通知新增 `type` 字段并内置默认类型：
    - `节日`、`生日`、`系统`、`自定义通知`。
  - 通知栏标签由静态“通知”改为动态显示当前通知类型（例如“生日”“节日”）。
  - 生产通知配置与 demo 通知配置同步升级：
    - 全部生日通知改为 `【🎂 日期】内容` 格式；
    - 生产配置保留春节（农历）与生日主题色规则；
    - demo 配置补全四类默认类型示例。
  - 文档更新：`README.md` 增加 `type` 字段说明、生日文案格式规范和 10 秒轮换说明。
- 规划功能：
  - 可选增加类型专属样式（如生日/节日图标或边框特效）。
  - 可选增加类型筛选开关（仅展示系统通知/节日通知等）。

### Step 39（2026-02-13）
- 已完成功能：
  - 新增应用配置文件 `data/app-config.json`，集中维护版本号与许可证标识：
    - `version: 0.0.2`
    - `license: GPL-2.0-only`
  - 页面标题上方新增版本号显示（`index.html` + `src/ui/styles.css`）：
    - 启动时从 `data/app-config.json` 读取版本；
    - 前端展示格式统一为 `v{version}`（当前显示 `v0.0.2`）；
    - 配置缺失或非法时回退 `v0.0.0`。
  - 新增开源协议文件 `LICENSE`（GPL v2 全文），协议落地为 GPL2。
  - 文档更新：
    - `README.md` 增加 `data/app-config.json` 说明；
    - `README.md` 新增 License 章节，明确 `GPL-2.0-only`；
    - `README.md` 项目结构补充 app/notice 配置文件。
- 规划功能：
  - 可选增加“构建时间/commit hash”显示（同样走 `app-config`）。
  - 可选增加“版本点击展开更新日志”入口。

### Step 40（2026-02-13）
- 已完成功能：
  - 页面最下方新增信息栏（`index.html` + `src/ui/styles.css`），展示：
    - `Developed by ...`
    - `Powered by ...`
    - `Last update: ...`
  - 底部信息全部接入 `data/app-config.json` 的 `footer` 配置，并在启动时加载渲染。
  - `Powered by` 文案格式升级为：
    - `Powered by {model} (reasoning {level}, summaries {mode})`
  - 当前配置已按需求设置为：
    - `model: gpt-5.3-codex`
    - `reasoning: high`
    - `summaries: auto`
    - 显示效果：`Powered by gpt-5.3-codex (reasoning high, summaries auto)`。
  - `README.md` 同步补充 `app-config.footer` 字段说明（developer/model/reasoning/summaries/lastUpdated）。
- 规划功能：
  - 可选增加页脚链接（如 GitHub 仓库、更新日志）。
  - 可选增加“自动从 git commit 生成 lastUpdated”的发布脚本。

### Step 41（2026-02-13）
- 已完成功能：
  - 增加 GitHub Pages 防缓存加载机制（`index.html`）：
    - 移除静态 `src/ui/styles.css` 与 `src/main.js` 直接引用；
    - 启动时先读取 `data/app-config.json`（`cache: no-store`）；
    - 按 `version + footer.lastUpdated` 拼接 `?v=` 参数后动态注入 CSS/JS。
  - 缓存兜底：
    - 当配置读取失败时，回退为时间戳参数，确保页面仍可加载最新资源。
  - 文档同步：
    - `README.md` 补充“version 参与防缓存参数”的说明；
    - 增加发布建议：发布时更新 `version` 或 `lastUpdated` 以触发资源换版本。
- 规划功能：
  - 可选增加 `assetVersion` 独立字段（与展示版本解耦）。
  - 可选增加“部署后自动写入版本号”的 GitHub Actions。

### Step 42（2026-02-13）
- 已完成功能：
  - 修复刷新首屏短暂无样式文本（FOUC）问题：在 `index.html` 增加 `assets-pending` 显示门控，样式表加载完成后再展示页面，并加 3 秒兜底超时防止白屏。
  - 按需求隐藏“棋盘拟合”控件：将 `#fitMode` 及其 `label` 设为 `hidden`，仅隐藏界面入口，保留 DOM 与原逻辑兼容。
- 规划功能：
  - 完成一次回归验证：确认刷新时不再出现“只有字”的未样式化页面。
  - 校验隐藏“棋盘拟合”后主流程（重开、计时、自动求解）无回归报错。

### Step 43（2026-02-13）
- 已完成功能：
  - 完成本次改动的静态回归检查：
    - `node --check src/main.js` 语法检查通过；
    - 核对 `index.html`，确认已引入 `assets-pending` 门控与 3 秒兜底；
    - 核对“棋盘拟合”控件已隐藏且 `#fitMode` 元素仍保留，避免初始化空指针。
- 规划功能：
  - 在浏览器手动验证刷新体验（首次加载与强制刷新）并观察是否还存在短暂无样式闪现。
  - 若仍有闪现，再补充首屏关键样式内联（仅首屏骨架）以进一步收敛 FOUC。

### Step 44（2026-02-13）
- 已完成功能：
  - 首屏加载体验二次优化（`index.html`）：
    - 将“整页隐藏”改为“仅隐藏 `.app` 主体”，避免刷新时出现整页白屏；
    - 新增内联首屏关键背景与字体样式，强制刷新阶段保持与正式页面接近的视觉底色；
    - 新增加载遮罩 `#bootSplash`（`正在加载...`），在资源就绪后自动淡出。
- 规划功能：
  - 完成静态检查，确认门控类切换与遮罩显隐规则一致。
  - 在浏览器做一次强制刷新回归，观察是否还存在明显闪屏。

### Step 45（2026-02-13）
- 已完成功能：
  - 完成二次优化后的静态回归检查：
    - `node --check src/main.js` 通过；
    - 门控类切换链路确认：`assets-pending` 在样式加载完成后被移除；
    - `#bootSplash` 显隐规则确认：加载期可见、资源就绪后淡出。
- 规划功能：
  - 在浏览器执行一次强制刷新（`Cmd+Shift+R`）体验回归，观察加载遮罩停留时长是否符合预期。
  - 若遮罩停留仍偏长，可继续优化为“配置读取与样式注入并行化”。
